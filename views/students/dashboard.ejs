<%- include('../partials/header') %>

<style>
  /* -------- Dashboard Styling -------- */
  
  .dash-welcome {
    background: linear-gradient(135deg, #2563eb, #3b82f6);
    padding: 30px;
    border-radius: 16px;
    color: white;
    box-shadow: 0 6px 18px rgba(37, 99, 235, 0.25);
  }

  .dash-avatar {
    width: 70px;
    height: 70px;
    background: rgba(255,255,255,0.2);
    border-radius: 50%;
    font-size: 1.8rem;
    font-weight: 600;
    display: flex; justify-content: center; align-items: center;
    margin-bottom: 10px;
    backdrop-filter: blur(6px);
  }

  .stats-box {
    background: white;
    padding: 18px;
    border-radius: 14px;
    text-align: center;
    box-shadow: 0 3px 12px rgba(0,0,0,0.06);
  }

  .stats-number {
    font-size: 1.6rem;
    font-weight: 700;
    color: #2563eb;
  }

  .dash-section-title {
    font-weight: 700;
    margin-bottom: 12px;
    color: #1e293b;
  }

  .quick-card {
    background: white;
    border-radius: 14px;
    padding: 18px;
    height: 100%;
    box-shadow: 0 4px 14px rgba(0,0,0,0.07);
    transition: .25s;
  }

  .quick-card:hover {
    transform: translateY(-4px);
  }

  .quick-icon {
    font-size: 1.9rem;
    margin-bottom: 8px;
  }

  .recommend-box {
    background: #f1f5ff;
    border-left: 4px solid #2563eb;
    padding: 16px;
    border-radius: 10px;
    margin-bottom: 15px;
  }

</style>

<%
  const u = currentUser || {}; // Use currentUser directly, fallback to empty object
  const initials = u.name ? u.name.split(' ').map(n => n[0]).join('').toUpperCase() : 'U';
%>

<div class="container mt-4 mb-5">

  <!-- =======================
         Welcome Header
  ======================== -->
  <div class="dash-welcome mb-4">
    <div class="row align-items-center">
      <div class="col-md-2 text-center">
        <div class="dash-avatar"><%= initials %></div>
      </div>
      <div class="col-md-10">
        <h3 class="fw-bold mb-1">Welcome back, <%= u.name.split(' ')[0] %> üëã</h3>
        <p class="mb-0">Ready to continue learning and growing today?</p>
      </div>
    </div>
  </div>

  <!-- =======================
        Quick Stats
  ======================== -->
  <h5 class="dash-section-title">Your Learning Stats</h5>
  <div class="row g-3 mb-4">
    <div class="col-4">
      <div class="stats-box">
        <div class="stats-number"><%= u.profile?.totalQuizzesTaken || 0 %></div>
        <div class="text-muted small">Quizzes Taken</div>
      </div>
    </div>
    <div class="col-4">
      <div class="stats-box">
        <div class="stats-number"><%= u.profile?.averageScore || 0 %>%</div>
        <div class="text-muted small">Avg. Score</div>
      </div>
    </div>
    <div class="col-4">
      <div class="stats-box">
        <div class="stats-number"><%= u.classRef?.classNumber || '-' %></div>
        <div class="text-muted small">Your Class</div>
      </div>
    </div>
  </div>

  <!-- =======================
        Recommendations
  ======================== -->
  <h5 class="dash-section-title">Recommended for You</h5>

  <!-- Example rules -->
  <% if ((u.profile?.averageScore || 0) < 40) { %>
    <div class="recommend-box">
      <strong>üìò Revision Recommended</strong>
      <br> Your scores show you might need revision. Check core lessons again.
    </div>
  <% } else if ((u.profile?.averageScore || 0) < 70) { %>
    <div class="recommend-box">
      <strong>üìù Practice More</strong>
      <br> You‚Äôre improving! Try more quizzes to boost confidence.
    </div>
  <% } else { %>
    <div class="recommend-box">
      <strong>üöÄ Great Work!</strong>
      <br> You're doing excellent. Explore new topics or try advanced quizzes.
    </div>
  <% } %>

  <!-- =======================
        Quick Actions
  ======================== -->
  <h5 class="dash-section-title">Quick Actions</h5>
  <div class="row g-4 mt-2">

    <div class="col-md-4 col-sm-6">
      <div class="quick-card">
        <div class="quick-icon text-primary">‚ùì</div>
        <h6 class="fw-semibold">Ask a Doubt</h6>
        <p class="small text-muted">Post your question & get helpful answers.</p>
        <a href="/forum/ask" class="btn btn-primary w-100 btn-modern">Ask Now</a>
      </div>
    </div>

    <div class="col-md-4 col-sm-6">
      <div class="quick-card">
        <div class="quick-icon text-info">üìö</div>
        <h6 class="fw-semibold">Lessons</h6>
        <p class="small text-muted">Access lessons & notes for your subjects.</p>
        <a href="/student/lessons" class="btn btn-info text-white w-100 btn-modern">View Lessons</a>
      </div>
    </div>

    <div class="col-md-4 col-sm-6">
      <div class="quick-card">
        <div class="quick-icon text-warning">üìù</div>
        <h6 class="fw-semibold">Take a Quiz</h6>
        <p class="small text-muted">Test what you‚Äôve learned today.</p>
        <a href="/student/quizzes" class="btn btn-warning w-100 btn-modern">Start Quiz</a>
        <a href="/student/results" class="btn btn-outline-warning w-100 mt-2 btn-modern">View Results</a>
      </div>
    </div>

  </div>

</div>

<%- include('../partials/footer') %>
